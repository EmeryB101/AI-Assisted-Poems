<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <meta name="description" content="Connected/Disconnected - An interactive poem through text conversations. Choose your responses to build the poem together.">
    <meta name="author" content="AI-Assisted Poetry Portfolio">
    <title>Interactive Poem: Connected/Disconnected</title>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            margin: 0;
            padding: 40px;
            background: linear-gradient(135deg, #0a0a0a 0%, #1a1a2e 25%, #16213e 50%, #1a1a2e 75%, #0a0a0a 100%);
            background-size: 400% 400%;
            animation: backgroundShift 15s ease infinite;
            font-family: 'Courier New', monospace;
            min-height: 100vh;
            display: flex;
            justify-content: center;
            align-items: center;
            position: relative;
            overflow-x: hidden;
        }

        @keyframes backgroundShift {
            0%, 100% { background-position: 0% 50%; }
            50% { background-position: 100% 50%; }
        }

        .matrix-bg {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            pointer-events: none;
            z-index: 0;
        }

        .container {
            max-width: 900px;
            background: rgba(10, 10, 10, 0.85);
            padding: 60px;
            box-shadow: 0 0 40px rgba(0, 212, 255, 0.3);
            position: relative;
            border: 1px solid rgba(0, 212, 255, 0.3);
            z-index: 1;
        }

        h1 {
            text-align: center;
            color: #00d4ff;
            margin-bottom: 40px;
            font-size: 1.8em;
            letter-spacing: 4px;
            text-shadow: 0 0 10px rgba(0, 212, 255, 0.5);
        }

        /* Phone container */
        .phone {
            width: 360px;
            height: 720px;
            margin: 0 auto;
            background: #1a1a1a;
            border: 12px solid #2a2a2a;
            border-radius: 40px;
            box-shadow: 0 0 40px rgba(0, 212, 255, 0.3), inset 0 0 20px rgba(0, 0, 0, 0.5);
            position: relative;
            overflow: hidden;
        }

        .phone::before {
            content: '';
            position: absolute;
            top: 0;
            left: 50%;
            transform: translateX(-50%);
            width: 150px;
            height: 30px;
            background: #2a2a2a;
            border-radius: 0 0 20px 20px;
            z-index: 100;
        }

        .status-bar {
            position: absolute;
            top: 10px;
            left: 0;
            right: 0;
            height: 30px;
            display: flex;
            justify-content: space-between;
            align-items: center;
            padding: 0 20px;
            color: #00d4ff;
            font-size: 11px;
            z-index: 101;
        }

        .signal-bars {
            display: flex;
            gap: 2px;
        }

        .signal-bar {
            width: 3px;
            background: #00d4ff;
            animation: signalFlicker 2s ease-in-out infinite;
        }

        .signal-bar:nth-child(1) { height: 4px; }
        .signal-bar:nth-child(2) { height: 7px; animation-delay: 0.2s; }
        .signal-bar:nth-child(3) { height: 10px; animation-delay: 0.4s; }
        .signal-bar:nth-child(4) { height: 13px; animation-delay: 0.6s; }

        @keyframes signalFlicker {
            0%, 100% { opacity: 1; }
            50% { opacity: 0.3; }
        }

        .screen {
            position: absolute;
            top: 50px;
            left: 0;
            right: 0;
            bottom: 20px;
            background: linear-gradient(135deg, #0d0d0d, #1a1a1a);
            overflow: hidden;
            padding: 20px;
            z-index: 10;
        }

        .app-grid {
            display: grid;
            grid-template-columns: repeat(3, 1fr);
            gap: 25px;
            margin-bottom: 40px;
        }

        .app-icon {
            width: 70px;
            height: 70px;
            margin: 0 auto;
            border-radius: 18px;
            background: linear-gradient(135deg, rgba(0, 212, 255, 0.3), rgba(123, 44, 191, 0.3));
            border: 2px solid rgba(0, 212, 255, 0.5);
            cursor: pointer;
            transition: all 0.3s ease;
            position: relative;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 30px;
        }

        .app-icon:hover {
            transform: scale(1.1);
            box-shadow: 0 0 20px rgba(0, 212, 255, 0.6);
        }

        .app-icon.unlocked {
            opacity: 0.5;
        }

        .app-label {
            text-align: center;
            color: #00d4ff;
            font-size: 11px;
            margin-top: 8px;
            letter-spacing: 0.5px;
        }

        /* Messages interface */
        .messages-view {
            position: absolute;
            top: 50px;
            left: 0;
            right: 0;
            bottom: 20px;
            background: rgba(0, 0, 0, 0.98);
            padding: 15px 10px 120px 10px;
            opacity: 0;
            pointer-events: none;
            overflow-y: auto;
            z-index: 50;
        }

        .messages-view.active {
            opacity: 1;
            pointer-events: all;
            animation: fadeIn 0.5s ease;
        }

        @keyframes fadeIn {
            from { opacity: 0; }
            to { opacity: 1; }
        }

        .messages-container {
            display: flex;
            flex-direction: column;
            gap: 12px;
        }

        .message-bubble {
            max-width: 75%;
            padding: 11px 14px;
            border-radius: 18px;
            line-height: 1.5;
            font-size: 0.95em;
            animation: bubbleAppear 0.4s ease;
        }

        @keyframes bubbleAppear {
            from {
                opacity: 0;
                transform: scale(0.85) translateY(8px);
            }
            to {
                opacity: 1;
                transform: scale(1) translateY(0);
            }
        }

        .message-bubble.from-them {
            align-self: flex-start;
            background: rgba(0, 212, 255, 0.2);
            border: 1px solid rgba(0, 212, 255, 0.4);
            color: #00d4ff;
        }

        .message-bubble.from-you {
            align-self: flex-end;
            background: rgba(255, 0, 110, 0.2);
            border: 1px solid rgba(255, 0, 110, 0.4);
            color: #ff006e;
        }

        .message-bubble.message-failed {
            align-self: center;
            background: rgba(220, 53, 69, 0.15);
            border: 1px solid rgba(220, 53, 69, 0.5);
            color: #dc3545;
            font-size: 0.85em;
            font-style: italic;
            text-align: center;
            animation: failureShake 0.5s ease;
        }

        @keyframes failureShake {
            0%, 100% { transform: translateX(0); }
            25% { transform: translateX(-5px); }
            75% { transform: translateX(5px); }
        }

        .response-choices {
            position: fixed;
            bottom: 20px;
            left: 10px;
            right: 10px;
            background: rgba(0, 0, 0, 0.95);
            border: 2px solid rgba(0, 212, 255, 0.5);
            border-radius: 15px;
            padding: 12px;
            display: flex;
            flex-direction: column;
            gap: 8px;
        }

        .response-btn {
            padding: 10px 15px;
            background: rgba(0, 212, 255, 0.1);
            border: 1px solid rgba(0, 212, 255, 0.4);
            border-radius: 12px;
            color: #00d4ff;
            cursor: pointer;
            transition: all 0.3s ease;
            font-size: 0.9em;
            text-align: center;
        }

        .response-btn:hover {
            background: rgba(0, 212, 255, 0.3);
            box-shadow: 0 0 15px rgba(0, 212, 255, 0.5);
            transform: translateY(-2px);
        }

        .text-input-container {
            position: fixed;
            bottom: 20px;
            left: 10px;
            right: 10px;
            background: rgba(0, 0, 0, 0.95);
            border: 2px solid rgba(0, 212, 255, 0.5);
            border-radius: 15px;
            padding: 12px;
            display: flex;
            gap: 10px;
            align-items: center;
        }

        .text-input {
            flex: 1;
            padding: 10px 15px;
            background: rgba(0, 212, 255, 0.05);
            border: 1px solid rgba(0, 212, 255, 0.3);
            border-radius: 12px;
            color: #00d4ff;
            font-size: 0.9em;
            font-family: 'Courier New', monospace;
            outline: none;
        }

        .text-input::placeholder {
            color: rgba(0, 212, 255, 0.4);
            font-style: italic;
        }

        .text-input:focus {
            background: rgba(0, 212, 255, 0.1);
            border-color: rgba(0, 212, 255, 0.6);
            box-shadow: 0 0 10px rgba(0, 212, 255, 0.3);
        }

        .send-btn {
            padding: 10px 20px;
            background: rgba(255, 0, 110, 0.3);
            border: 1px solid #ff006e;
            border-radius: 12px;
            color: #ff006e;
            cursor: pointer;
            font-size: 0.9em;
            font-family: 'Courier New', monospace;
            transition: all 0.3s ease;
            text-transform: uppercase;
            letter-spacing: 1px;
        }

        .send-btn:hover {
            background: rgba(255, 0, 110, 0.5);
            box-shadow: 0 0 15px rgba(255, 0, 110, 0.5);
        }

        .close-msg-btn {
            position: absolute;
            top: 10px;
            right: 15px;
            width: 30px;
            height: 30px;
            border-radius: 50%;
            background: rgba(0, 212, 255, 0.2);
            border: 2px solid #00d4ff;
            color: #00d4ff;
            font-size: 18px;
            cursor: pointer;
            display: flex;
            align-items: center;
            justify-content: center;
            transition: all 0.3s ease;
            z-index: 60;
        }

        .close-msg-btn:hover {
            background: rgba(0, 212, 255, 0.4);
            box-shadow: 0 0 15px rgba(0, 212, 255, 0.6);
        }

        /* Power off display */
        .power-display {
            position: absolute;
            top: 50px;
            left: 0;
            right: 0;
            bottom: 20px;
            background: rgba(0, 0, 0, 0.98);
            display: flex;
            flex-direction: column;
            justify-content: center;
            align-items: center;
            opacity: 0;
            pointer-events: none;
            z-index: 50;
        }

        .power-display.active {
            opacity: 1;
            pointer-events: all;
            animation: fadeIn 0.5s ease;
        }

        .power-off-btn {
            padding: 15px 40px;
            background: rgba(255, 0, 110, 0.3);
            border: 2px solid #ff006e;
            color: #ff006e;
            border-radius: 25px;
            cursor: pointer;
            font-size: 1.1em;
            transition: all 0.3s ease;
            font-family: 'Courier New', monospace;
            text-transform: uppercase;
            letter-spacing: 2px;
        }

        .power-off-btn:hover {
            background: rgba(255, 0, 110, 0.5);
            box-shadow: 0 0 20px rgba(255, 0, 110, 0.6);
        }

        .power-off-overlay {
            position: absolute;
            top: 0;
            left: 0;
            right: 0;
            bottom: 0;
            background: #000;
            display: flex;
            flex-direction: column;
            justify-content: center;
            align-items: center;
            opacity: 0;
            pointer-events: none;
            z-index: 200;
        }

        .power-off-overlay.active {
            opacity: 1;
            pointer-events: all;
            animation: powerDown 4s ease forwards;
        }

        @keyframes powerDown {
            0% {
                opacity: 1;
                filter: brightness(1);
            }
            40% {
                opacity: 1;
                filter: brightness(0.5);
            }
            70% {
                opacity: 0.9;
                transform: scaleY(0.1);
                filter: brightness(0.1);
            }
            100% {
                opacity: 0;
                transform: scaleY(0);
            }
        }

        .shutdown-text {
            color: #fff;
            font-size: 1.3em;
            text-align: center;
            margin: 10px 0;
            animation: fadeShutdown 3s ease forwards;
            opacity: 0;
        }

        @keyframes fadeShutdown {
            0% {
                opacity: 0;
                transform: translateY(20px);
            }
            25% {
                opacity: 1;
                transform: translateY(0);
            }
            75% {
                opacity: 1;
            }
            100% {
                opacity: 0;
            }
        }

        .sr-only {
            position: absolute;
            width: 1px;
            height: 1px;
            padding: 0;
            margin: -1px;
            overflow: hidden;
            clip: rect(0, 0, 0, 0);
            white-space: nowrap;
            border-width: 0;
        }
    </style>
</head>
<body>
    <canvas class="matrix-bg" id="matrix" aria-hidden="true"></canvas>

    <main class="container" role="main">
        <header>
            <h1>CONNECTED / DISCONNECTED</h1>
            <p class="sr-only">Interactive poem through text conversations</p>
        </header>

        <div class="phone" role="region" aria-label="Interactive phone interface">
            <div class="status-bar" aria-hidden="true">
                <div class="signal-bars">
                    <div class="signal-bar"></div>
                    <div class="signal-bar"></div>
                    <div class="signal-bar"></div>
                    <div class="signal-bar"></div>
                </div>
                <div>12:34</div>
                <div>89%</div>
            </div>

            <!-- Home screen -->
            <div class="screen" id="homeScreen">
                <div class="app-grid">
                    <div class="app-item">
                        <div class="app-icon" onclick="openApp(0)" tabindex="0" role="button">üì±</div>
                        <div class="app-label">Screen</div>
                    </div>
                    <div class="app-item">
                        <div class="app-icon" onclick="openApp(1)" tabindex="0" role="button">üîî</div>
                        <div class="app-label">Notify</div>
                    </div>
                    <div class="app-item">
                        <div class="app-icon" onclick="openApp(2)" tabindex="0" role="button">üë•</div>
                        <div class="app-label">Social</div>
                    </div>
                    <div class="app-item">
                        <div class="app-icon" onclick="openApp(3)" tabindex="0" role="button">üëÅÔ∏è</div>
                        <div class="app-label">Camera</div>
                    </div>
                    <div class="app-item">
                        <div class="app-icon" onclick="openApp(4)" tabindex="0" role="button">üìú</div>
                        <div class="app-label">Feed</div>
                    </div>
                    <div class="app-item">
                        <div class="app-icon" onclick="openApp(5)" tabindex="0" role="button">üí≠</div>
                        <div class="app-label">Empty</div>
                    </div>
                    <div class="app-item">
                        <div class="app-icon" onclick="openApp(6)" tabindex="0" role="button">üìä</div>
                        <div class="app-label">Info</div>
                    </div>
                    <div class="app-item">
                        <div class="app-icon" onclick="openApp(7)" tabindex="0" role="button">üåä</div>
                        <div class="app-label">Stream</div>
                    </div>
                    <div class="app-item">
                        <div class="app-icon" onclick="openApp(8)" tabindex="0" role="button">üß†</div>
                        <div class="app-label">Memory</div>
                    </div>
                    <div class="app-item">
                        <div class="app-icon" onclick="openApp(9)" tabindex="0" role="button">üí¨</div>
                        <div class="app-label">Compose</div>
                    </div>
                </div>
            </div>

            <!-- Message views for each app -->
            <div class="messages-view" id="msg0">
                <button class="close-msg-btn" onclick="closeApp()">√ó</button>
                <div class="messages-container" id="chat0"></div>
                <div id="choices0"></div>
            </div>

            <div class="messages-view" id="msg1">
                <button class="close-msg-btn" onclick="closeApp()">√ó</button>
                <div class="messages-container" id="chat1"></div>
                <div id="choices1"></div>
            </div>

            <div class="messages-view" id="msg2">
                <button class="close-msg-btn" onclick="closeApp()">√ó</button>
                <div class="messages-container" id="chat2"></div>
                <div id="choices2"></div>
            </div>

            <div class="messages-view" id="msg3">
                <button class="close-msg-btn" onclick="closeApp()">√ó</button>
                <div class="messages-container" id="chat3"></div>
                <div id="choices3"></div>
            </div>

            <div class="messages-view" id="msg4">
                <button class="close-msg-btn" onclick="closeApp()">√ó</button>
                <div class="messages-container" id="chat4"></div>
                <div id="choices4"></div>
            </div>

            <div class="messages-view" id="msg5">
                <button class="close-msg-btn" onclick="closeApp()">√ó</button>
                <div class="messages-container" id="chat5"></div>
                <div id="choices5"></div>
            </div>

            <div class="messages-view" id="msg6">
                <button class="close-msg-btn" onclick="closeApp()">√ó</button>
                <div class="messages-container" id="chat6"></div>
                <div id="choices6"></div>
            </div>

            <div class="messages-view" id="msg7">
                <button class="close-msg-btn" onclick="closeApp()">√ó</button>
                <div class="messages-container" id="chat7"></div>
                <div id="choices7"></div>
            </div>

            <!-- Compose app - free text input -->
            <div class="messages-view" id="msg9">
                <button class="close-msg-btn" onclick="closeApp()">√ó</button>
                <div class="messages-container" id="chat9"></div>
                <div class="text-input-container" id="textInput9">
                    <input type="text" id="userInput9" class="text-input" placeholder="type your response..." maxlength="100">
                    <button class="send-btn" onclick="sendUserText()">Send</button>
                </div>
            </div>

            <!-- Power display for Memory app -->
            <div class="power-display" id="powerDisplay">
                <button class="power-off-btn" onclick="powerOff()">Power Off</button>
            </div>

            <!-- Power off overlay -->
            <div class="power-off-overlay" id="powerOffOverlay">
                <div class="shutdown-text">maybe silence</div>
                <div class="shutdown-text" style="animation-delay: 1s;">is connection</div>
            </div>
        </div>
    </main>

    <script>
        // Conversations for each app
        const conversations = [
            // App 0: Screen (glass, separation, tactile loss)
            [
                { from: 'them', text: 'glass between us, cold and clear‚Äî' },
                { from: 'you', choices: ['shimmering separation', 'see-through silence', 'surface so smooth', 'can\'t cross it'] },
                { from: 'them', text: 'skin craves skin, but finds only screen' },
                { from: 'you', choices: ['smooth, sterile stillness', 'warmth turned winter', 'touch turned digital', 'nothing real remains'] },
                { from: 'them', text: 'do you remember what hands felt like?' },
                { from: 'you', choices: ['barely breathing memory', 'fading like photographs', 'never knew', 'trying to forget'] }
            ],
            // App 1: Notify (pings as prayers, desperate waiting)
            [
                { from: 'them', text: 'every ping a prayer‚Äî' },
                { from: 'you', choices: ['please be present', 'prove you\'re there', 'pull me closer', 'piercing silence'] },
                { from: 'them', text: 'waiting, watching, willing you to‚Äî' },
                { from: 'you', choices: ['answer this ache', 'witness my wounds', 'wake from wherever', 'wander away'] },
                { from: 'them', text: 'how many notifications until you notice?' },
                { from: 'you', choices: ['counting each cry', 'drowning in digits', 'never enough', 'stopped counting'] }
            ],
            // App 2: Social (alone/together paradox, curated emptiness)
            [
                { from: 'them', text: 'alone together, scrolling in sync‚Äî' },
                { from: 'you', choices: ['crowded by ghosts', 'companions in vacancy', 'curating our cages', 'lost in the scroll'] },
                { from: 'them', text: 'swipe left on loneliness, still lonely‚Äî' },
                { from: 'you', choices: ['likes won\'t love me', 'followers who flee', 'hearts hollow as hell', 'no one's really there'] },
                { from: 'them', text: 'when did connection become collection?' },
                { from: 'you', choices: ['cataloging our collapse', 'measuring in metrics', 'can\'t remember before', 'connection died quietly'] }
            ],
            // App 3: Camera (seeing/being seen, filtered reality)
            [
                { from: 'them', text: 'through the lens, are you looking at me?' },
                { from: 'you', choices: ['gazing through glass', 'glimpsing your ghost', 'seeing only screens', 'somewhere beneath pixels'] },
                { from: 'them', text: 'filter upon filter, faces fade‚Äî' },
                { from: 'you', choices: ['beauty bleached blank', 'perfected into nothing', 'polished till invisible', 'can\'t find the real'] },
                { from: 'them', text: 'who are we without the glow?' },
                { from: 'you', choices: ['buried beneath brightness', 'forgotten behind filters', 'never knew ourselves', 'nothing without it'] }
            ],
            // App 4: Feed (endless consumption, hunger never satisfied)
            [
                { from: 'them', text: 'fingers forever scrolling, seeking‚Äî' },
                { from: 'you', choices: ['sustenance in silence', 'feeding on fragments', 'scrolling past souls', 'starving while consuming'] },
                { from: 'them', text: 'we swallow stories, stay hungry‚Äî' },
                { from: 'you', choices: ['feast on the fleeting', 'gorging on ghosts', 'full of emptiness', 'never satisfied'] },
                { from: 'them', text: 'what were we hungry for, before?' },
                { from: 'you', choices: ['meaning, maybe', 'moments, not metrics', 'can\'t remember feasts', 'nothing nourishes now'] }
            ],
            // App 5: Empty (void, hollowness, hunger for substance)
            [
                { from: 'them', text: 'hollow hearts, holding nothing‚Äî' },
                { from: 'you', choices: ['echoing endlessly', 'emptiness within emptiness', 'hungry for something heavy', 'void seeking void'] },
                { from: 'them', text: 'we fill the silence with noise‚Äî' },
                { from: 'you', choices: ['still so quiet inside', 'sound won\'t save us', 'screaming into stillness', 'nothing fills it'] },
                { from: 'them', text: 'is emptiness all that\'s left?' },
                { from: 'you', choices: ['all I\'ve ever known', 'aching for absence', 'emptiness is everything', 'can\'t feel fullness'] }
            ],
            // App 6: Info (drowning in data, truth vs noise)
            [
                { from: 'them', text: 'drowning in data, gasping for truth‚Äî' },
                { from: 'you', choices: ['buried beneath bytes', 'suffocating in signals', 'thirsty while drowning', 'truth turns to static'] },
                { from: 'them', text: 'they promised knowledge, delivered noise‚Äî' },
                { from: 'you', choices: ['wisdom washed away', 'lost in the overflow', 'learning to forget', 'can\'t hear truth anymore'] },
                { from: 'them', text: 'how do we surface from this sea?' },
                { from: 'you', choices: ['swimming toward silence', 'sinking feels safer', 'never learned to float', 'drowning is all we know'] }
            ],
            // App 7: Stream (flood of content, language lost)
            [
                { from: 'them', text: 'streaming endlessly, words washed away‚Äî' },
                { from: 'you', choices: ['language liquefied', 'speaking in static', 'silence swallowed whole', 'words won\'t hold weight'] },
                { from: 'them', text: 'we pour ourselves out, evaporate‚Äî' },
                { from: 'you', choices: ['vapor, not voice', 'flooding into nothing', 'flow without form', 'can\'t catch the current'] },
                { from: 'them', text: 'what\'s left when the stream runs dry?' },
                { from: 'you', choices: ['dust of dialogue', 'dried-up desires', 'silence, finally', 'nothing ever was'] }
            ]
        ];

        let appUnlocked = [false, false, false, false, false, false, false, false, false, false];
        let appProgress = [0, 0, 0, 0, 0, 0, 0, 0, 0]; // Track position in each conversation
        let currentApp = null;
        let composeStep = 0; // Track conversation step for Compose app

        function openApp(index) {
            if (index === 8) {
                // Memory app - just show power button
                document.getElementById('powerDisplay').classList.add('active');
                if (!appUnlocked[8]) {
                    appUnlocked[8] = true;
                    document.querySelectorAll('.app-icon')[8].classList.add('unlocked');
                }
                currentApp = 8;
                return;
            }

            if (index === 9) {
                // Compose app - free text input
                currentApp = 9;
                const msgView = document.getElementById('msg9');
                msgView.classList.add('active');

                if (!appUnlocked[9]) {
                    appUnlocked[9] = true;
                    document.querySelectorAll('.app-icon')[9].classList.add('unlocked');
                    startComposeConversation();
                }
                return;
            }

            currentApp = index;
            const msgView = document.getElementById('msg' + index);
            msgView.classList.add('active');

            if (!appUnlocked[index]) {
                appUnlocked[index] = true;
                document.querySelectorAll('.app-icon')[index].classList.add('unlocked');
                startConversation(index);
            }
        }

        function closeApp() {
            if (currentApp !== null) {
                if (currentApp === 8) {
                    document.getElementById('powerDisplay').classList.remove('active');
                } else if (currentApp === 9) {
                    document.getElementById('msg9').classList.remove('active');
                    // Reset text input visibility for next time
                    document.getElementById('textInput9').style.display = 'flex';
                } else {
                    document.getElementById('msg' + currentApp).classList.remove('active');
                }
                currentApp = null;
            }
        }

        function startConversation(appIndex) {
            const conversation = conversations[appIndex];
            const chatContainer = document.getElementById('chat' + appIndex);
            const choicesContainer = document.getElementById('choices' + appIndex);

            appProgress[appIndex] = 0;
            chatContainer.innerHTML = '';
            choicesContainer.innerHTML = '';

            showNextMessage(appIndex);
        }

        function showNextMessage(appIndex) {
            const conversation = conversations[appIndex];
            const progress = appProgress[appIndex];

            if (progress >= conversation.length) {
                return; // Conversation complete
            }

            const message = conversation[progress];
            const chatContainer = document.getElementById('chat' + appIndex);
            const choicesContainer = document.getElementById('choices' + appIndex);

            if (message.from === 'them') {
                // Add their message
                const bubble = document.createElement('div');
                bubble.className = 'message-bubble from-them';
                bubble.textContent = message.text;
                chatContainer.appendChild(bubble);
                chatContainer.scrollTop = chatContainer.scrollHeight;

                appProgress[appIndex]++;
                setTimeout(() => showNextMessage(appIndex), 800);
            } else {
                // Show choices for user
                const choicesDiv = document.createElement('div');
                choicesDiv.className = 'response-choices';

                message.choices.forEach(choice => {
                    const btn = document.createElement('button');
                    btn.className = 'response-btn';
                    btn.textContent = choice;
                    btn.onclick = () => selectResponse(appIndex, choice, choicesDiv);
                    choicesDiv.appendChild(btn);
                });

                choicesContainer.appendChild(choicesDiv);
            }
        }

        function selectResponse(appIndex, choice, choicesDiv) {
            const chatContainer = document.getElementById('chat' + appIndex);

            // Check if choice is negative (triggers message failure)
            const negativeKeywords = [
                'never', 'nothing', "can't", 'died', 'no one',
                'stopped', 'trying to forget', 'drowning is all we know',
                'wander away', 'connection died', 'lost in the scroll'
            ];

            const isNegative = negativeKeywords.some(keyword =>
                choice.toLowerCase().includes(keyword)
            );

            // Remove choices
            choicesDiv.remove();

            // Add user's response
            const bubble = document.createElement('div');
            bubble.className = 'message-bubble from-you';
            bubble.textContent = choice;
            chatContainer.appendChild(bubble);
            chatContainer.scrollTop = chatContainer.scrollHeight;

            if (isNegative) {
                // Show delivery failure after brief delay
                setTimeout(() => {
                    const failBubble = document.createElement('div');
                    failBubble.className = 'message-bubble message-failed';
                    failBubble.textContent = '‚ö† Message Not Delivered';
                    chatContainer.appendChild(failBubble);
                    chatContainer.scrollTop = chatContainer.scrollHeight;
                }, 800);
                // Conversation ends here - don't progress
            } else {
                // Move to next message
                appProgress[appIndex]++;
                setTimeout(() => showNextMessage(appIndex), 1000);
            }
        }

        // Compose app functions
        function startComposeConversation() {
            composeStep = 0;
            const chatContainer = document.getElementById('chat9');
            chatContainer.innerHTML = '';

            // Show first prompt
            setTimeout(() => {
                const bubble = document.createElement('div');
                bubble.className = 'message-bubble from-them';
                bubble.textContent = 'tell me what you\'re holding onto‚Äî';
                chatContainer.appendChild(bubble);
                chatContainer.scrollTop = chatContainer.scrollHeight;
            }, 500);
        }

        function sendUserText() {
            const input = document.getElementById('userInput9');
            const userText = input.value.trim();

            if (!userText) return;

            const chatContainer = document.getElementById('chat9');

            // Add user's message
            const userBubble = document.createElement('div');
            userBubble.className = 'message-bubble from-you';
            userBubble.textContent = userText;
            chatContainer.appendChild(userBubble);
            chatContainer.scrollTop = chatContainer.scrollHeight;

            // Clear input
            input.value = '';

            // Get response based on step
            composeStep++;
            const response = getComposeResponse(composeStep, userText);

            if (response) {
                setTimeout(() => {
                    const bubble = document.createElement('div');
                    bubble.className = 'message-bubble from-them';
                    bubble.textContent = response;
                    chatContainer.appendChild(bubble);
                    chatContainer.scrollTop = chatContainer.scrollHeight;
                }, 800);
            } else {
                // Conversation complete - hide input
                setTimeout(() => {
                    document.getElementById('textInput9').style.display = 'none';
                    const finalBubble = document.createElement('div');
                    finalBubble.className = 'message-bubble from-them';
                    finalBubble.textContent = 'our poem is complete.';
                    finalBubble.style.fontStyle = 'italic';
                    finalBubble.style.opacity = '0.7';
                    chatContainer.appendChild(finalBubble);
                    chatContainer.scrollTop = chatContainer.scrollHeight;
                }, 800);
            }
        }

        function getComposeResponse(step, userInput) {
            const responses = [
                'and what are you letting go?',
                'between holding and releasing, what remains?',
                'when silence settles, what do you hear?',
                'if words could bridge this distance‚Äî',
                'speak the thing you cannot say aloud.'
            ];

            return responses[step - 1] || null;
        }

        // Allow Enter key to send message
        document.addEventListener('DOMContentLoaded', () => {
            const input = document.getElementById('userInput9');
            if (input) {
                input.addEventListener('keypress', (e) => {
                    if (e.key === 'Enter') {
                        sendUserText();
                    }
                });
            }
        });

        function powerOff() {
            const overlay = document.getElementById('powerOffOverlay');
            overlay.classList.add('active');

            setTimeout(() => {
                document.querySelector('.phone').style.transition = 'opacity 1.5s ease';
                document.querySelector('.phone').style.opacity = '0';
            }, 4000);
        }

        // Matrix background
        const canvas = document.getElementById('matrix');
        const ctx = canvas.getContext('2d');

        canvas.width = window.innerWidth;
        canvas.height = window.innerHeight;

        const chars = '01„Ç¢„Ç§„Ç¶„Ç®„Ç™„Ç´„Ç≠„ÇØ„Ç±„Ç≥„Çµ„Ç∑„Çπ„Çª„ÇΩ„Çø„ÉÅ„ÉÑ„ÉÜ„Éà„Éä„Éã„Éå„Éç„Éé„Éè„Éí„Éï„Éò„Éõ„Éû„Éü„É†„É°„É¢„É§„É¶„É®„É©„É™„É´„É¨„É≠„ÉØ„É≤„É≥';
        const fontSize = 14;
        const columns = canvas.width / fontSize;
        const drops = [];

        for (let i = 0; i < columns; i++) {
            drops[i] = Math.random() * -100;
        }

        function drawMatrix() {
            ctx.fillStyle = 'rgba(10, 10, 10, 0.05)';
            ctx.fillRect(0, 0, canvas.width, canvas.height);

            ctx.fillStyle = '#00d4ff';
            ctx.font = fontSize + 'px monospace';

            for (let i = 0; i < drops.length; i++) {
                const text = chars[Math.floor(Math.random() * chars.length)];
                const x = i * fontSize;
                const y = drops[i] * fontSize;

                ctx.fillStyle = `rgba(0, 212, 255, ${Math.random() * 0.5 + 0.3})`;
                ctx.fillText(text, x, y);

                if (y > canvas.height && Math.random() > 0.975) {
                    drops[i] = 0;
                }

                drops[i]++;
            }
        }

        setInterval(drawMatrix, 50);

        window.addEventListener('resize', () => {
            canvas.width = window.innerWidth;
            canvas.height = window.innerHeight;
        });
    </script>
</body>
</html>
